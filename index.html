<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finodex</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
          "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
      }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #0f0f0f; }
        /* Animación suave para el botón */
        .btn-load:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Upload, FileJson, Search, ExternalLink, RefreshCw, AlertCircle, Filter, ChevronDown } from 'lucide-react';

        // Hook para subir archivos manualmente (por si acaso)
        const useFileUpload = (setCards, setError) => {
            const fileInputRef = useRef(null);
            const handleFileChange = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = JSON.parse(e.target.result);
                        if (Array.isArray(json)) { setCards(json); setError(null); }
                        else { setCards([json]); setError(null); }
                    } catch (err) { setError("Error al leer JSON."); }
                };
                reader.readAsText(file);
            };
            return { fileInputRef, handleFileChange };
        };

        const Card = ({ data }) => {
            const name = data["Finoler"] || "Desconocido";
            const avatarStat = data["Avatar"] || 0;
            const cunadismoStat = data["Cuñadismo"] || 0;
            const rarity = data["Rareza"] || "Común";
            const link = data["Primera Aparición"];
            const imageSrc = data["FinoCard"];
            const ratio = data["Ratio"] || "0";
            const PRIMARY_RED = '#c1272d';
            const ACCENT_YELLOW = '#ffe000';

            return (
                <div className="group relative overflow-hidden rounded-xl transition-all duration-300 hover:shadow-[0_0_20px_rgba(193,39,45,0.6)] hover:scale-105"
                     style={{ aspectRatio: '44/67', backgroundColor: '#1a1a1a', border: `2px solid ${PRIMARY_RED}` }}>
                    
                    {/* Imagen con Lazy Loading para que no explote el móvil */}
                    <div className="absolute inset-0 w-full h-full bg-black">
                        {imageSrc ? (
                            <iframe 
                                src={imageSrc} 
                                className="w-full h-full pointer-events-none" 
                                frameBorder="0" 
                                title={name}
                                loading="lazy" 
                            />
                        ) : (
                            <div className="flex items-center justify-center h-full text-gray-500">Sin Imagen</div>
                        )}
                    </div>
                    
                    {/* Capa invisible para mejorar el click en pantallas táctiles */}
                    <div className="absolute inset-0 z-10"></div>
                    
                    <div className="absolute inset-0 bg-black/95 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-between p-4 z-20 pointer-events-none group-hover:pointer-events-auto">
                        <div className="flex justify-center mb-2">
                            <span className="px-3 py-1 text-xs font-bold uppercase rounded-full shadow-md tracking-wider"
                                  style={{ backgroundColor: PRIMARY_RED, color: ACCENT_YELLOW }}>
                                {rarity}
                            </span>
                        </div>
                        <div className="text-center border-b pb-2" style={{ borderColor: PRIMARY_RED }}>
                            <h3 className="font-bold text-xl tracking-wider truncate" style={{ color: ACCENT_YELLOW }}>{name}</h3>
                            <p className="text-xs text-gray-400 mt-1">Ratio K/D: <span className="text-white">{ratio}</span></p>
                        </div>
                        <div className="space-y-3 my-2">
                            <div>
                                <div className="flex justify-between text-xs font-bold mb-1 text-white">
                                    <span>AVATAR</span><span style={{ color: PRIMARY_RED }}>{avatarStat}</span>
                                </div>
                                <div className="w-full bg-gray-800 rounded-full h-2">
                                    <div className="h-2 rounded-full" style={{ width: `${Math.min(avatarStat, 100)}%`, backgroundColor: PRIMARY_RED }}></div>
                                </div>
                            </div>
                            <div>
                                <div className="flex justify-between text-xs font-bold mb-1 text-white">
                                    <span>CUÑADISMO</span><span style={{ color: ACCENT_YELLOW }}>{cunadismoStat}</span>
                                </div>
                                <div className="w-full bg-gray-800 rounded-full h-2">
                                    <div className="h-2 rounded-full" style={{ width: `${Math.min(cunadismoStat, 100)}%`, backgroundColor: ACCENT_YELLOW }}></div>
                                </div>
                            </div>
                        </div>
                        <div className="pt-2 border-t border-gray-800 text-center pointer-events-auto">
                            {link && (
                                <a href={link} target="_blank" rel="noopener noreferrer" className="inline-flex items-center text-xs hover:underline transition-colors" style={{ color: '#fff' }}>
                                    <ExternalLink size={12} className="mr-1" /> Primera Aparición
                                </a>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        function FinodexApp() {
            const [cards, setCards] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedRarity, setSelectedRarity] = useState(null);
            const [error, setError] = useState(null);
            
            // CONFIGURACIÓN DE RENDIMIENTO: Empezamos mostrando solo 12
            const [visibleCount, setVisibleCount] = useState(12);
            
            const { fileInputRef, handleFileChange } = useFileUpload(setCards, setError);
            const PRIMARY_RED = '#c1272d';
            const ACCENT_YELLOW = '#ffe000';

            // Carga automática del JSON
            useEffect(() => {
                fetch('./cards.json')
                    .then(res => {
                        if (!res.ok) throw new
